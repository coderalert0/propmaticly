<!-- Event snippet for Sign-up conversion page -->
<script>
    gtag('event', 'conversion', {'send_to': 'AW-734442813/ayH6CImluLUaEL3qmt4C'});
</script>

<div class="container my-5">
  <!-- Organization Name -->
  <div class="fw-bold fs-2hx mb-5">
    <%= @organization.name %>
  </div>

  <!-- First Row: Violations & Inspections Stats -->
  <div class="row g-5 g-xl-8 mb-5">
    <!-- Total Open Violations -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-folder fs-3hx me-3 text-danger"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @violations.open.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Open Violations</span>
        </div>
      </div>
    </div>

    <!-- Total Violations Being Addressed -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-hammer fs-3hx me-3 text-primary"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @violations.in_progress.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Violations Being Addressed</span>
        </div>
      </div>
    </div>

    <!-- Total Violations Closed -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-check-circle fs-3hx me-3 text-success"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @violations.closed.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Violations Closed</span>
        </div>
      </div>
    </div>

    <!-- Upcoming Inspections (Annual) -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-clipboard-check fs-3hx me-3 text-warning"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @inspections.incomplete.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Upcoming Inspections (Annual)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Second Row: Complaints & Overdue Inspections -->
  <div class="row g-5 g-xl-8 mb-5">
    <!-- Total Active Complaints -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-folder fs-3hx me-3 text-danger"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @complaints.open.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Active Complaints</span>
        </div>
      </div>
    </div>

    <!-- Total Complaints Being Addressed -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-hammer fs-3hx me-3 text-primary"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @complaints.in_progress.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Complaints Being Addressed</span>
        </div>
      </div>
    </div>

    <!-- Total Closed Complaints -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-check-circle fs-3hx me-3 text-success"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @complaints.closed.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Total Closed Complaints</span>
        </div>
      </div>
    </div>

    <!-- Overdue Inspections -->
    <div class="col-12 col-md-6 col-xl-3">
      <div class="card bg-body card-xl-stretch mb-xl-8">
        <div class="card-body text-center">
          <div class="d-flex align-items-center justify-content-center mb-2">
            <i class="bi bi-clipboard-check fs-3hx me-3 text-danger"></i>
            <span class="fs-2hx fw-bold text-gray-800">
              <%= @inspections.overdue.size %>
            </span>
          </div>
          <span class="fs-6 text-muted">Overdue Inspections</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Portfolio Table Section -->
  <div id="kt_app_content" class="app-content flex-column-fluid">
    <div class="card">
      <div class="card-header border-0 pt-6">
        <div class="card-toolbar">
          <% if can?(:create, Portfolio) %>
            <%= link_to 'Add Portfolio', '#', class: 'btn btn-success', data: { controller: 'modal', action: 'modal#open', bs_target: "#newModal" } %>
          <% end %>
        </div>
      </div>
      <div class="card-body">
        <div>
          <table class="table align-middle table-row-dashed gy-3">
            <thead>
            <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0">
              <th class="w-25">Portfolio Name</th>
              <th class="w-25">Open Violations</th>
              <th class="w-25">Open Complaints</th>
              <th class="w-25">Number of Buildings</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            <% @portfolios.each do |portfolio| %>
              <tr>
                <td><%= portfolio.name %></td>
                <td>
                  <div class="badge border rounded-0">
                    <%= portfolio.violations.accessible_by(current_ability).open.size %>
                  </div>
                </td>
                <td>
                  <div class="badge border rounded-0">
                    <%= portfolio.complaints.accessible_by(current_ability).open.size %>
                  </div>
                </td>
                <td>
                  <%= link_to portfolio.buildings.accessible_by(current_ability).size, portfolio_buildings_path(portfolio), class: 'badge bg-primary text-white rounded-0' %>
                </td>
                <td class="text-end d-none d-md-table-cell">
                  <div class="dropdown">
                    <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
                      Actions
                    </button>
                    <div class="dropdown-menu">
                      <% if can?(:edit, portfolio) %>
                        <%= link_to 'Edit', '#', class: 'dropdown-item', data: { controller: 'modal', action: 'modal#open', bs_target: "#editPortfolioModal-#{portfolio.id}" } %>
                      <% end %>
                      <% if can?(:destroy, portfolio) && portfolio.buildings.blank? %>
                        <%= link_to 'Delete', '#', class: 'dropdown-item', data: { controller: 'modal', action: 'modal#open', bs_target: "#deletePortfolioModal-#{portfolio.id}" } %>
                      <% end %>
                    </div>
                  </div>
                </td>
              </tr>
              <%= render 'portfolios/edit', portfolio: portfolio %>
              <%= render 'portfolios/delete', portfolio: portfolio %>
            <% end %>
            </tbody>
          </table>
        </div>
        <div class="d-flex justify-content-center mt-4">
          <%= paginate @portfolios, theme: 'bootstrap4' %>
        </div>
        <%= render 'portfolios/new' %>
      </div>
    </div>
  </div>
</div>
